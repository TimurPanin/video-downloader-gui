# Changelog - Video Downloader

## [1.2.5] - 2024-12-19

### Исправлено
- **Критическая проблема с видимостью опций плейлиста**: Опции "Разрешить MIX/радио" и "Скачать первые N" теперь появляются при автоопределении режима по URL
- **Несинхронизированное состояние интерфейса**: Видимость опций теперь синхронизирована с выбранным режимом независимо от источника изменения
- **Отсутствие обновления при программном изменении**: Добавлен механизм отслеживания изменений переменной режима

### Добавлено
- **Переменная `is_playlist_var`**: Для отслеживания состояния режима плейлиста
- **Функция `update_playlist_options_visibility()`**: Управление видимостью опций плейлиста
- **Обработчик `_on_mode_change()`**: Автоматическое обновление при изменении режима
- **`trace_add('write')`**: Отслеживание изменений переменной `download_mode_var`

### Технические детали
- Добавлена переменная `is_playlist_var` для отслеживания состояния режима
- Реализована функция `update_playlist_options_visibility()` для управления видимостью
- Добавлен `trace_add('write')` на `download_mode_var` для автоматического обновления
- Обновление видимости вызывается при автоопределении режима по URL
- Установлено начальное состояние при создании интерфейса

## [1.2.4] - 2024-12-19

### Исправлено
- **Видимость опций плейлиста**: Опции "Разрешить MIX/радио" и "Скачать первые N" теперь показываются только при выборе режима "Скачать плейлист"
- **Лишний текст в главном меню**: Убран системный ключ 'menu.youtube.btn' из интерфейса, заменен на нормальный текст "YouTube"
- **Неинтуитивный интерфейс**: Опции плейлиста теперь появляются динамически по контексту

### Добавлено
- **Динамическое управление видимостью**: Опции плейлиста скрыты по умолчанию и показываются только при необходимости
- **Чистый интерфейс**: Убран лишний системный текст из кнопок главного меню
- **Контекстные опции**: Интерфейс адаптируется к выбранному режиму загрузки

### Технические детали
- Изменена логика показа/скрытия опций плейлиста в методе `on_type_change()`
- Заменены системные ключи на статический текст в кнопках главного меню
- Опции плейлиста изначально скрыты и показываются только при выборе соответствующего режима

## [1.2.3] - 2024-12-19

### Исправлено
- **Отсутствие предупреждения для RD-плейлистов**: Добавлена проверка MIX/радио плейлистов с предупреждением
- **Проблема с раскладкой клавиатуры**: Горячие клавиши и Enter теперь работают независимо от раскладки (RU/EN)
- **Неработающие горячие клавиши**: Исправлена обработка событий клавиатуры для русской раскладки

### Добавлено
- **Функция `is_rd_playlist()`**: Определение RD-плейлистов (MIX/радио) по URL
- **Проверка RD-плейлистов**: Предупреждение при попытке загрузки RD-плейлиста без включенной опции
- **Обработчики Enter**: Универсальная обработка нажатия Enter для запуска загрузки
- **Локализованные предупреждения**: Сообщения об ошибках на выбранном языке

### Технические детали
- Добавлена функция `is_rd_playlist(url)` для определения MIX/радио плейлистов
- Заменены обработчики событий с `event.char` на `event.keysym` для универсальности
- Добавлены обработчики `<Return>` и `<KP_Enter>` для полей URL
- Реализована проверка RD-плейлистов в методе `start_download()`

## [1.2.2] - 2024-12-19

### Исправлено
- **Неполное переключение языка**: Теперь все элементы интерфейса обновляются при смене языка
- **Неинформативные сообщения об ошибках**: Добавлены конкретные домены в сообщения валидации URL
- **Локализация логов**: Сообщения в логах теперь переведены на выбранный язык

### Добавлено
- **Модуль I18N.py**: Единая система интернационализации с полной схемой переводов
- **Функция `tr()`**: Глобальная функция для получения переведенных строк
- **Улучшенная валидация URL**: Функция `validate_url_or_warn()` с информативными сообщениями
- **Полное переключение языка**: Обновление всех элементов интерфейса без перезапуска

### Технические детали
- Создан модуль `I18N.py` с полной схемой переводов (ru/en)
- Добавлена функция `tr(key, **kwargs)` для получения переведенных строк
- Улучшены сообщения об ошибках с подстановкой списка доменов
- Реализовано полное обновление всех элементов интерфейса при смене языка

## [1.2.1] - 2024-12-19

### Исправлено
- **Краш при переключении языка**: Исправлена небезопасная работа со шрифтами Tkinter
- **Автоопределение режима загрузки**: YouTube страница теперь автоматически определяет тип контента по URL
- **Безопасность шрифтов**: Использование `tkfont.nametofont()` для нормализации шрифтов
- **Обработка событий**: Добавлены обработчики `KeyRelease` и `FocusOut` для автоопределения

### Добавлено
- **Функция `detect_download_mode()`**: Автоматическое определение типа контента (single/playlist)
- **Обработчик `_on_url_change()`**: Реакция на изменение URL в реальном времени
- **Финальная проверка**: Корректировка режима перед началом загрузки
- **Логирование изменений**: Уведомления о автоматических изменениях режима
- **Unit тесты**: Полное тестирование функции автоопределения

### Технические детали
- Безопасная работа с `widget.cget('font')` через `tkfont.nametofont()`
- Парсинг URL через `urlparse` и `parse_qs` для анализа параметров
- Обработка различных форматов YouTube URL (playlist, watch, shorts)
- Автоматическая корректировка режима при несоответствии URL

## [1.2.0] - 2024-12-19

### Добавлено
- **Улучшенные описания сервисов**: Интернационализированные описания для YouTube и TikTok
- **Структурированные настройки качества**: Отдельная секция для выбора качества видео
- **Улучшенная группировка элементов**: Более четкое разделение настроек на YouTube странице
- **Документация UI**: Подробное описание улучшений интерфейса

### Изменено
- **Главная страница**: Добавлены интернационализированные описания сервисов
- **YouTube страница**: Улучшена структура настроек качества и аудио
- **Тесты**: Расширены тесты для новых строк интернационализации

### Технические детали
- Добавлены строки `youtube_description` и `tiktok_description` в i18n
- Улучшена группировка элементов на YouTube странице
- Создана документация UI_IMPROVEMENTS.md

## [1.1.0] - 2024-12-19

### Добавлено
- **Улучшенный интерфейс настроек загрузки**: Radio group для выбора режима загрузки
- **Интернационализация**: Добавлена строка "Режим загрузки" / "Download mode"
- **Улучшенная структура**: Более четкое разделение опций загрузки

### Изменено
- **YouTube страница**: Заменены отдельные BooleanVar на единый StringVar для режима загрузки
- **Логика переключения**: Упрощена логика показа/скрытия опций плейлиста
- **Тесты**: Добавлены тесты для новых строк интернационализации

### Технические детали
- Использование `tk.StringVar` вместо `tk.BooleanVar` для radio group
- Значения: "single" для одиночного видео, "playlist" для плейлиста
- Автоматическое обновление интерфейса при смене режима

## [1.0.0] - 2024-12-19

### Первоначальный релиз
- Полнофункциональное приложение для скачивания видео
- Поддержка YouTube и TikTok
- Двуязычный интерфейс (русский/английский)
- Автоматическое создание cookies из браузера
- Прогресс-бар с реальным временем
- Модульная архитектура
- Unit-тесты
- Сборка в .exe файл
